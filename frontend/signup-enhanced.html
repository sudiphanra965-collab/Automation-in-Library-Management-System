<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Student Registration - Library System</title>
  <script src="libs/tailwind.min.js"></script>
  <style>
    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    .photo-preview {
      width: 150px;
      height: 150px;
      border: 2px dashed #cbd5e0;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-center;
      overflow: hidden;
      background: #f7fafc;
      cursor: pointer;
      transition: all 0.3s;
    }
    .photo-preview:hover {
      border-color: #4299e1;
      background: #ebf8ff;
    }
    .photo-preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .id-proof-preview {
      width: 100%;
      max-width: 400px;
      height: 250px;
      border: 2px dashed #cbd5e0;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-center;
      overflow: hidden;
      background: #f7fafc;
      cursor: pointer;
      transition: all 0.3s;
    }
    .id-proof-preview:hover {
      border-color: #4299e1;
      background: #ebf8ff;
    }
    .id-proof-preview img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
  </style>
</head>
<body>
  <div class="max-w-4xl mx-auto">
    <!-- Header -->
    <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
      <h1 class="text-3xl font-bold text-gray-800 mb-2">üìö Student Registration</h1>
      <p class="text-gray-600">Complete your profile to access the library system</p>
      <p class="text-sm text-orange-600 mt-2">‚ö†Ô∏è Your registration will be verified by admin before activation</p>
    </div>

    <!-- Registration Form -->
    <form id="registrationForm" class="bg-white rounded-lg shadow-lg p-8">
      
      <!-- User Photo Section -->
      <div class="mb-8">
        <h2 class="text-xl font-bold text-gray-800 mb-4">üì∏ Profile Photo</h2>
        <div class="flex items-center gap-6">
          <div class="photo-preview" id="userPhotoPreview" onclick="document.getElementById('userPhotoInput').click()">
            <span class="text-gray-400 text-center">
              <svg class="w-12 h-12 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
              </svg>
              Click to upload
            </span>
          </div>
          <div>
            <input type="file" id="userPhotoInput" accept="image/*" class="hidden" required>
            <button type="button" onclick="document.getElementById('userPhotoInput').click()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
              Choose Photo
            </button>
            <p class="text-sm text-gray-500 mt-2">Upload a clear passport-size photo</p>
            <p class="text-xs text-gray-400">Max size: 5MB | Format: JPG, PNG</p>
          </div>
        </div>
      </div>

      <!-- Personal Details -->
      <div class="mb-8">
        <h2 class="text-xl font-bold text-gray-800 mb-4">üë§ Personal Details</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          
          <div>
            <label class="block text-gray-700 font-medium mb-2">Full Name *</label>
            <input type="text" id="fullName" required 
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              placeholder="Enter your full name">
          </div>

          <div>
            <label class="block text-gray-700 font-medium mb-2">roll Number *</label>
            <input type="text" id="rollNo" required 
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              placeholder="e.g., 21CS001">
          </div>

          <div>
            <label class="block text-gray-700 font-medium mb-2">Date of Birth *</label>
            <input type="date" id="dateOfBirth" required 
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>

          <div>
            <label class="block text-gray-700 font-medium mb-2">Mobile Number *</label>
            <input type="tel" id="mobileNo" required pattern="[0-9]{10}"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              placeholder="10-digit mobile number">
          </div>

        </div>
      </div>

      <!-- Account Details -->
      <div class="mb-8">
        <h2 class="text-xl font-bold text-gray-800 mb-4">üîê Account Details</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          
          <div>
            <label class="block text-gray-700 font-medium mb-2">Username *</label>
            <input type="text" id="username" required 
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              placeholder="Choose a username">
          </div>

          <div>
            <label class="block text-gray-700 font-medium mb-2">Email</label>
            <input type="email" id="email"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              placeholder="your.email@college.edu">
          </div>

          <div>
            <label class="block text-gray-700 font-medium mb-2">Password *</label>
            <input type="password" id="password" required minlength="6"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              placeholder="Minimum 6 characters">
          </div>

          <div>
            <label class="block text-gray-700 font-medium mb-2">Confirm Password *</label>
            <input type="password" id="confirmPassword" required minlength="6"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              placeholder="Re-enter password">
          </div>

        </div>
      </div>

      <!-- ID Proof Section -->
      <div class="mb-8">
        <h2 class="text-xl font-bold text-gray-800 mb-4">üÜî College ID Proof</h2>
        <p class="text-sm text-gray-600 mb-4">Upload a clear photo of your college ID card for verification</p>
        
        <div class="id-proof-preview" id="idProofPreview" onclick="document.getElementById('idProofInput').click()">
          <span class="text-gray-400 text-center">
            <svg class="w-16 h-16 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path>
            </svg>
            Click to upload College ID
          </span>
        </div>
        <input type="file" id="idProofInput" accept="image/*" class="hidden" required>
        
        <div class="mt-4">
          <button type="button" onclick="document.getElementById('idProofInput').click()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
            Choose ID Photo
          </button>
          <p class="text-sm text-gray-500 mt-2">Make sure your ID card is clearly visible</p>
          <p class="text-xs text-gray-400">Max size: 5MB | Format: JPG, PNG</p>
        </div>
      </div>

      <!-- Terms & Conditions -->
      <div class="mb-6">
        <label class="flex items-start">
          <input type="checkbox" id="termsCheckbox" required class="mt-1 mr-2">
          <span class="text-sm text-gray-600">
            I agree to the terms and conditions. I understand that my registration will be reviewed by the admin and I will be notified once verified.
          </span>
        </label>
      </div>

      <!-- Submit Button -->
      <div class="flex gap-4">
        <button type="submit" id="submitBtn" class="flex-1 bg-blue-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-blue-700 transition-colors">
          üìù Submit Registration
        </button>
        <button type="button" onclick="window.location.href='/'" class="px-6 py-3 bg-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-400 transition-colors">
          Cancel
        </button>
      </div>

      <!-- Status Message -->
      <div id="statusMessage" class="hidden mt-4 p-4 rounded-lg"></div>

    </form>
  </div>

  <script>
    // Determine API base URL
    function getAPIBase() {
      const hostname = window.location.hostname;
      const currentPort = window.location.port;
      const protocol = window.location.protocol;
      
      // If already on HTTPS port, use relative URLs
      if (currentPort === '5443' || protocol === 'https:') {
        return '';
      }
      
      // For localhost (desktop)
      if (hostname === 'localhost' || hostname === '127.0.0.1') {
        // Try HTTPS first, fallback to HTTP
        return window.location.protocol === 'https:' ? '' : 'http://localhost:5000';
      }
      
      // For mobile/network access - use current protocol and port
      return `${window.location.protocol}//${hostname}:${currentPort || (protocol === 'https:' ? '5443' : '5000')}`;
    }
    
    const API_BASE = getAPIBase();
    
    // Preview user photo
    document.getElementById('userPhotoInput').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        if (file.size > 5 * 1024 * 1024) {
          alert('File size must be less than 5MB');
          e.target.value = '';
          return;
        }
        const reader = new FileReader();
        reader.onload = function(e) {
          document.getElementById('userPhotoPreview').innerHTML = `<img src="${e.target.result}" alt="User Photo">`;
        };
        reader.readAsDataURL(file);
      }
    });

    // Preview ID proof
    document.getElementById('idProofInput').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        if (file.size > 5 * 1024 * 1024) {
          alert('File size must be less than 5MB');
          e.target.value = '';
          return;
        }
        const reader = new FileReader();
        reader.onload = function(e) {
          document.getElementById('idProofPreview').innerHTML = `<img src="${e.target.result}" alt="ID Proof">`;
        };
        reader.readAsDataURL(file);
      }
    });

    // Form submission
    document.getElementById('registrationForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const password = document.getElementById('password').value;
      const confirmPassword = document.getElementById('confirmPassword').value;
      
      if (password !== confirmPassword) {
        showMessage('Passwords do not match!', 'error');
        return;
      }
      
      const userPhoto = document.getElementById('userPhotoInput').files[0];
      const idProof = document.getElementById('idProofInput').files[0];
      
      if (!userPhoto || !idProof) {
        showMessage('Please upload both photos!', 'error');
        return;
      }
      
      const submitBtn = document.getElementById('submitBtn');
      submitBtn.disabled = true;
      submitBtn.textContent = '‚è≥ Submitting...';
      
      try {
        const formData = new FormData();
        formData.append('fullName', document.getElementById('fullName').value);
        formData.append('rollNo', document.getElementById('rollNo').value);
        formData.append('dateOfBirth', document.getElementById('dateOfBirth').value);
        formData.append('mobileNo', document.getElementById('mobileNo').value);
        formData.append('username', document.getElementById('username').value);
        formData.append('email', document.getElementById('email').value);
        formData.append('password', password);
        formData.append('userPhoto', userPhoto);
        formData.append('idProof', idProof);
        
        const response = await fetch(`${API_BASE}/api/register-student`, {
          method: 'POST',
          body: formData
        });
        
        const data = await response.json();
        
        if (response.ok) {
          showMessage('‚úÖ Registration submitted successfully! Your account will be activated after admin verification.', 'success');
          setTimeout(() => {
            window.location.href = '/';
          }, 3000);
        } else {
          showMessage('‚ùå ' + (data.error || 'Registration failed'), 'error');
          submitBtn.disabled = false;
          submitBtn.textContent = 'üìù Submit Registration';
        }
        
      } catch (error) {
        console.error('Registration error:', error);
        showMessage('‚ùå Network error. Please try again.', 'error');
        submitBtn.disabled = false;
        submitBtn.textContent = 'üìù Submit Registration';
      }
    });
    
    function showMessage(message, type) {
      const statusDiv = document.getElementById('statusMessage');
      statusDiv.className = `mt-4 p-4 rounded-lg ${type === 'success' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`;
      statusDiv.textContent = message;
      statusDiv.classList.remove('hidden');
      
      if (type === 'success') {
        setTimeout(() => {
          statusDiv.classList.add('hidden');
        }, 5000);
      }
    }
  </script>
</body>
</html>
